# Taxonomy Viewer Guide

## Overview

The Taxonomy Viewer is a new UI feature that allows you to visualize and explore the hierarchical documentation taxonomy generated by the `build_taxonomy` command. It provides an interactive, hierarchical view of your documentation organized by topics, clusters (modules), and individual pages.

## Features

### 1. **Hierarchical Organization**
- **Topics**: Top-level categories that group related documentation
- **Clusters/Modules**: Groups of semantically similar pages with:
  - Difficulty level (beginner, intermediate, advanced)
  - Estimated completion time
  - Cohesion score (how similar pages are within the cluster)
  - Prerequisites
  - Learning outcomes

### 2. **Rich Metadata Display**
- Overall statistics (total pages, topics, modules, avg cohesion)
- Module-level information:
  - Description
  - Difficulty level
  - Prerequisites
  - Learning outcomes
  - Number of pages
  - Estimated hours to complete
  
### 3. **Interactive Features**
- **Search**: Real-time search across topics, modules, and pages
- **Expandable Modules**: Click to show/hide pages in each module
- **Page Links**: Direct links to individual page details
- **Color-coded Badges**: Visual indicators for difficulty, cohesion, and page count

### 4. **Navigation**
- Access from Client Detail page: Click "ðŸ“š View Taxonomy" button
- Access from Client Pages view: Click "ðŸ“š View Taxonomy" link in breadcrumb
- Breadcrumb navigation to easily return to previous views

## How to Use

### Step 1: Generate a Taxonomy

Before viewing the taxonomy in the UI, you need to generate it using the management command:

```bash
python manage.py build_taxonomy --client-id <CLIENT_ID>
```

For example, to build a taxonomy for DynaTrace (client ID 5):

```bash
python manage.py build_taxonomy --client-id 5
```

This will:
1. Load all analyzed pages for the client
2. Cluster pages by semantic similarity using embeddings
3. Build prerequisite graphs
4. Generate cluster summaries with GPT-4o-mini
5. Export taxonomy files to `taxonomies/` directory

**Output Files:**
- `{client_slug}_taxonomy_YYYYMMDD.json` - Full taxonomy data
- `{client_slug}_taxonomy_YYYYMMDD.md` - Human-readable markdown
- `{client_slug}_prerequisite_graph.dot` - GraphViz graph
- `{client_slug}_prerequisite_graph.mmd` - Mermaid diagram
- `{client_slug}_taxonomy_report.txt` - Statistics report

### Step 2: Access the Taxonomy Viewer

1. **From Dashboard**: Go to Dashboard â†’ Select a Client
2. **From Client Detail Page**: Click the "ðŸ“š View Taxonomy" button (green button at top right)
3. **From Client Pages View**: Click "ðŸ“š View Taxonomy" link in the breadcrumb

**Direct URL:** `http://localhost:8000/client/<client_id>/taxonomy/`

### Step 3: Explore the Taxonomy

#### Search
- Type in the search box to filter topics, modules, or pages
- Search is real-time and searches across:
  - Topic names
  - Module names and descriptions
  - Learning outcomes
  - Prerequisites
  - Page titles

#### View Topics
- Topics are displayed as expandable sections
- Each topic shows:
  - Number of total pages
  - Description
  - All modules within that topic

#### View Modules/Clusters
- Each module card displays:
  - **Name**: Generated by AI based on page content
  - **Badges**: Difficulty, cohesion score, page count, estimated hours
  - **Description**: AI-generated summary of module content
  - **Prerequisites**: What you need to know before starting
  - **Learning Outcomes**: What you'll learn from this module
  - **Pages**: Click "Show Pages" to expand the page list

#### View Individual Pages
- Click "Show Pages" button on any module
- Pages display in a grid with:
  - Page title
  - URL
  - Document type
  - Audience level
  - Link to full page details

## Understanding the Data

### Statistics Panel
Located at the top of the taxonomy view:
- **Total Pages**: Number of pages analyzed
- **Topics**: Number of top-level categories
- **Modules**: Number of semantic clusters
- **Avg Module Size**: Average pages per module
- **Avg Cohesion**: How well-grouped the modules are (0-1 scale, higher is better)

### Difficulty Levels
- **Beginner**: Introductory content, minimal prerequisites
- **Intermediate**: Requires some prior knowledge
- **Advanced**: Complex topics requiring significant background

### Cohesion Score
- Measures how semantically similar pages are within a cluster
- Range: 0.0 to 1.0
- Higher scores = more focused, coherent modules
- Lower scores = more diverse content within the module

## Troubleshooting

### "No Taxonomy Available" Message

If you see this message, it means:
1. No taxonomy has been generated yet for this client
2. The taxonomy files are missing from the `taxonomies/` directory

**Solution**: Run the `build_taxonomy` command:
```bash
python manage.py build_taxonomy --client-id <CLIENT_ID>
```

### Empty Taxonomy

If the taxonomy loads but shows no topics:
1. Check that pages have AI analysis (topics, learning objectives)
2. Verify pages have embeddings
3. Run AI analysis first: `python manage.py analyze_content --job-id <JOB_ID>`
4. Then generate embeddings: `python manage.py generate_embeddings --job-id <JOB_ID>`
5. Finally build taxonomy: `python manage.py build_taxonomy --client-id <CLIENT_ID>`

### Multiple Taxonomy Versions

The viewer automatically loads the most recent taxonomy file based on file modification time. If you want to use an older version, manually rename the file in the `taxonomies/` directory.

## API Access

You can also access taxonomy data programmatically:

### Load Taxonomy Directly
```python
from pathlib import Path
import json

taxonomy_file = Path('taxonomies/dynatrace_taxonomy_20251130.json')
with open(taxonomy_file) as f:
    taxonomy = json.load(f)

# Access structure
print(f"Total pages: {taxonomy['statistics']['total_pages']}")
print(f"Topics: {len(taxonomy['taxonomy']['root_topics'])}")

for topic in taxonomy['taxonomy']['root_topics']:
    print(f"Topic: {topic['name']}")
    for cluster in topic['clusters']:
        print(f"  Module: {cluster['name']} ({len(cluster['pages'])} pages)")
```

### Via Django View
```python
from django.urls import reverse

# Get taxonomy URL for a client
taxonomy_url = reverse('dashboard:client_taxonomy', kwargs={'client_id': 5})
# Returns: /client/5/taxonomy/
```

## Best Practices

1. **Regenerate Regularly**: As you add new crawled pages, regenerate the taxonomy to include them
2. **Review Clusters**: Check if the AI-generated module names and descriptions make sense
3. **Adjust Parameters**: Experiment with clustering parameters in `build_taxonomy` command
4. **Use Prerequisites**: The prerequisite graph can guide learning path creation
5. **Export Options**: Use markdown exports for documentation, JSON for programmatic access

## Technical Details

### File Locations
- Taxonomy viewer template: `dashboard/templates/dashboard/client_taxonomy.html`
- View function: `dashboard/views.py::client_taxonomy()`
- URL pattern: `dashboard/urls.py` - `/client/<int:client_id>/taxonomy/`
- Taxonomy files: `taxonomies/{client_slug}_taxonomy_{date}.json`

### How It Works
1. View loads the most recent taxonomy JSON file for the client
2. Template renders the hierarchical structure with interactive elements
3. JavaScript provides search and toggle functionality
4. Links connect to existing page detail views

### Styling
The taxonomy viewer uses:
- Custom CSS for cards, badges, and layouts
- Color-coded difficulty badges
- Responsive grid layouts
- Smooth transitions and hover effects

## Future Enhancements

Potential improvements:
- Interactive prerequisite graph visualization
- Learning path recommendations
- Progress tracking for users
- Export as learning curriculum
- Compare taxonomies over time
- Filter by difficulty/topic
- Bookmark favorite modules

## Questions or Issues?

If you encounter problems:
1. Check the Django logs for errors
2. Verify taxonomy files exist in `taxonomies/` directory
3. Ensure client has crawled pages with AI analysis
4. Review the `build_taxonomy` command output for warnings

For more details on building taxonomies, see `TAXONOMY_BUILDER_GUIDE.md`.

