{% extends "dashboard/base.html" %}

{% block title %}Dashboard - DocAnalyzer{% endblock %}

{% block content %}
<style>
    .header-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .btn-new-crawl {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem 2rem;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .btn-new-crawl:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
</style>

<div class="header-section">
    <h1 style="margin: 0;">Dashboard Overview</h1>
    <a href="{% url 'dashboard:new_crawl' %}" class="btn-new-crawl">
        ðŸš€ New Crawl
    </a>
</div>

<div class="stats">
    <div class="stat-card">
        <h3>Total Jobs</h3>
        <div class="value">{{ total_jobs }}</div>
    </div>
    <div class="stat-card">
        <h3>Active Jobs</h3>
        <div class="value">{{ active_jobs }}</div>
    </div>
    <div class="stat-card">
        <h3>Completed Jobs</h3>
        <div class="value">{{ completed_jobs }}</div>
    </div>
    <div class="stat-card">
        <h3>Failed Jobs</h3>
        <div class="value">{{ failed_jobs }}</div>
    </div>
    <div class="stat-card">
        <h3>Total Pages Crawled</h3>
        <div class="value">{{ total_pages }}</div>
    </div>
</div>

<div class="card">
    <h2>Recent Crawl Jobs</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Client</th>
                <th>Target URL</th>
                <th>Status</th>
                <th>Pages</th>
                <th>Created</th>
            </tr>
        </thead>
        <tbody>
            {% for job in recent_jobs %}
            <tr>
                <td><a href="{% url 'dashboard:job_detail' job.id %}">#{{ job.id }}</a></td>
                <td><a href="{% url 'dashboard:client_detail' job.client.id %}">{{ job.client.name }}</a></td>
                <td>{{ job.target_url|truncatechars:50 }}</td>
                <td><span class="badge badge-{{ job.status }}">{{ job.get_status_display }}</span></td>
                <td>{{ job.pages_crawled|default:0 }}</td>
                <td>{{ job.created_at|date:"M d, Y H:i" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" style="text-align: center; color: #7f8c8d;">No crawl jobs yet</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Clients</h2>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Total Jobs</th>
                <th>Total Pages</th>
                <th>Contact</th>
            </tr>
        </thead>
        <tbody>
            {% for client in clients %}
            <tr>
                <td><a href="{% url 'dashboard:client_detail' client.id %}">{{ client.name }}</a></td>
                <td>{{ client.job_count }}</td>
                <td>{{ client.total_pages }}</td>
                <td>{{ client.contact_email }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align: center; color: #7f8c8d;">No clients yet</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
